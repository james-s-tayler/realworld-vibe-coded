# Use the official Playwright Docker image that matches our package version
FROM mcr.microsoft.com/playwright:v1.55.0-noble

# Install .NET SDK using the official installer script
RUN curl -sSL https://dot.net/v1/dotnet-install.sh | bash /dev/stdin --install-dir /usr/share/dotnet --channel 9.0

# Add .NET to PATH
ENV PATH="/usr/share/dotnet:${PATH}"
ENV DOTNET_ROOT="/usr/share/dotnet"

WORKDIR /tests

# Copy project file first for better layer caching
COPY E2eTests/E2eTests.csproj E2eTests/

# Restore dependencies in a separate layer for better caching
RUN dotnet restore E2eTests/E2eTests.csproj

# Copy the rest of the test files
COPY E2eTests/ E2eTests/

# Set environment variables for headless operation
ENV CI=true
ENV PLAYWRIGHT_HEADLESS=true

# Set the entry point to run the tests
ENTRYPOINT ["dotnet", "test", "./E2eTests/E2eTests.csproj", "-c", "Release", "--logger", "trx;LogFileName=e2e-results.trx", "--results-directory", "/Reports/Test/e2e/Results", "--verbosity", "normal"]